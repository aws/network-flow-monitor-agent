#!/bin/bash

set -o errexit
set -o pipefail
set -o nounset

BPFTOP_DIR="/tmp/bpftop"
BPFTOP_VERSION="v0.5.0"  # Use latest stable version

echo "Downloading bpftop binary..."

rm -rf "$BPFTOP_DIR"
mkdir -p "$BPFTOP_DIR/bpftop/target/release"

# Download pre-built binary from GitHub releases
wget -q "https://github.com/Netflix/bpftop/releases/download/${BPFTOP_VERSION}/bpftop" \
    -O "$BPFTOP_DIR/bpftop/target/release/bpftop"

# Make it executable
chmod +x "$BPFTOP_DIR/bpftop/target/release/bpftop"

echo "bpftop downloaded to: $BPFTOP_DIR/bpftop/target/release/bpftop"